<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>
        </title>
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
        <link rel="stylesheet" href="my.css" />
        <style>
            /* App custom styles */
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
        </script>
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.js">
        </script>
        <script src="my.js">
        </script>
    </head>
    <body>
        <!-- Home -->
        <div data-role="page" id="page1">
            <div data-theme="a" data-role="header">
                <a data-role="button" data-theme="b" href="index.html" data-icon="home" data-iconpos="left" class="ui-btn-left">
                    HOME
                </a>
                <h3 id="idtitile">
                    Header
                </h3>
                <a data-role="button" data-theme="b" href="task.html" data-icon="back" data-iconpos="left" class="ui-btn-right">
                    BACK
                </a>
            </div>
            <div data-role="content">
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <label for="filestat" id="filestatlb">
                        </label>
                        <textarea  id="filename" placeholder="" data-mini="true" style="height:100px">
                        </textarea>
                    </fieldset>
                </div>
                <input type="button" onclick="download()" data-theme="b" value="下载到本地" />
                <div data-role="collapsible-set">
                    <div data-role="collapsible" data-collapsed="false">
                        <h3>
                            Log
                        </h3>
						<div id="downloadlog"></div>
                    </div>
                </div>
            </div>
        <script>
           
			$('#idtitile').empty();
			$('#idtitile').append("ID:"+  $.lixian.id);
			   $.ajaxSetup({scriptCharset:'utf-8'});
	
			
				jQuery.getJSON("cgi-bin/list.py?tasktype=" +$.lixian.tasktype +"&id=" + $.lixian.id ,
				function(data){
						$('#filestatlb').append( data[0].status_text);
						$('#filename').empty();
						$('#filename').append( data[0].name);
				});   
			
			function download()
			{
			 $.ajax({
			   type: "POST",
			   data: { id: $.lixian.id},
			   url: "cgi-bin/download.py",
			   success: function(msg){}
			   });
			}
			
			function readlog()
			{
				if($.lixian.id==-1)
				return;
				
			 $.ajax({
			   type: "POST",
			   data: { id: $.lixian.id},
			   url: "cgi-bin/log.py",
			   success: function(msg){
			    $('#downloadlog').empty();
			    $('#downloadlog').append(msg);
				setTimeout(readlog, 3000);
				}
			   });
			   
			}
			
			readlog();
        </script>
		</div>
        
    </body>
</html>